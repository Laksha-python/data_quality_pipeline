contract_version: 1.0

meta:
  dataset:
    name: orders_pipeline
    owner: your_team
    description: Brazilian ecommerce dataset

defaults:
  timezone: UTC
  date_formats:
    - "%Y-%m-%d"
    - "%Y-%m-%d %H:%M:%S"

auto_infer: false

tables:

  raw.customers:
    description: one row per customer
    grain: one row per customer
    primary_key:
      - customer_id

    source:
      type: csv
      path: data/raw/orders_pipeline/customers.csv

    columns:
      customer_id:
        type: string
        semantic_type: id
        required: true
        unique: true

      customer_unique_id:
        type: string
        semantic_type: id
        required: true
        unique: true

      customer_zip_code_prefix:
        type: int
        semantic_type: category
        required: false
        unique: false

      customer_city:
        type: string
        semantic_type: category
        required: false
        unique: false

      customer_state:
        type: string
        semantic_type: category
        required: false
        unique: false

    freshness:
      timestamp_column: customer_unique_id   # best available proxy
      expected_hours: 24
      max_delay_hours: 6

    volume:
      expected_daily_rows: 5
      variability_percent: 50


  raw.orders:
    description: one row per order
    grain: one row per order
    primary_key:
      - order_id

    source:
      type: csv
      path: data/raw/orders_pipeline/orders.csv

    columns:
      order_id:
        type: string
        semantic_type: id
        required: true
        unique: true

      customer_id:
        type: string
        semantic_type: id
        required: true
        unique: false
        fk: raw.customers.customer_id

      order_status:
        type: string
        semantic_type: category
        required: true
        unique: false

      order_purchase_timestamp:
        type: timestamp
        semantic_type: timestamp
        required: true
        unique: false

      order_delivered_customer_date:
        type: timestamp
        semantic_type: timestamp
        required: false
        unique: false

    freshness:
      timestamp_column: order_purchase_timestamp
      expected_minutes: 5
      max_delay_minutes: 10

    volume:
      expected_daily_rows: 20
      variability_percent: 50


  raw.order_items:
    description: one row per order item
    grain: one row per order per item
    primary_key:
      - order_id
      - order_item_id

    source:
      type: csv
      path: data/raw/orders_pipeline/order_items.csv

    columns:
      order_id:
        type: string
        semantic_type: id
        required: true
        unique: false
        fk: raw.orders.order_id

      order_item_id:
        type: int
        semantic_type: id
        required: true
        unique: false

      product_id:
        type: string
        semantic_type: id
        required: true
        unique: false

      price:
        type: float
        semantic_type: currency
        required: true
        unique: false

      freight_value:
        type: float
        semantic_type: currency
        required: false
        unique: false

    freshness:
      timestamp_column: order_id   # no timestamp â†’ proxy
      expected_hours: 24
      max_delay_hours: 12

    volume:
      expected_daily_rows: 50
      variability_percent: 60


  raw.order_payments:
    description: one row per payment
    grain: one row per order per payment
    primary_key:
      - order_id
      - payment_sequential

    source:
      type: csv
      path: data/raw/orders_pipeline/order_payments.csv

    columns:
      order_id:
        type: string
        semantic_type: id
        required: true
        unique: false
        fk: raw.orders.order_id

      payment_sequential:
        type: int
        semantic_type: id
        required: true
        unique: false

      payment_type:
        type: string
        semantic_type: category
        required: true
        unique: false

      payment_installments:
        type: int
        semantic_type: quantity
        required: false
        unique: false

      payment_value:
        type: float
        semantic_type: currency
        required: true
        unique: false

    freshness:
      timestamp_column: order_id   # proxy
      expected_hours: 24
      max_delay_hours: 12

    volume:
      expected_daily_rows: 30
      variability_percent: 50
